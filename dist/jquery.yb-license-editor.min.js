!function(e,i,s,c){"use strict";function n(i,s){this.element=i,this.settings=e.extend({},t,s),this.init()}var t={enabled:!1,defaultLicense:{type:"cc",content:{adaptation:"sa",commercial:"n"}},licensePickerSubmitButtonText:null,onEnableLicense:function(){},onLicenseSelected:function(){},onShowLicensePicker:function(){}};e.extend(n.prototype,{init:function(){var i=this,s=e(this.element);"text"===s.attr("type")||"hidden"===s.attr("type")?(this.$input=s,this.$input.hide()):(this.$button=s,this.$button.on("click",function(){i.showLicensePicker()})),this.initLicense(),this.initLicenseLabel(),this.initLicensePicker(),this.updateLicenseLabel()},initLicense:function(){var i=this.$input?this.$input.val():null;if(i)this.licenseEnabled=!0,this.updateLicense(JSON.parse(i));else{var s=this.getLicenseFromLocalStorage();s?(this.licenseEnabled=!0,this.updateLicense(s)):this.$input?(this.licenseEnabled=this.settings.enabled,this.licenseEnabled?this.updateLicense(e.extend(!0,{},this.settings.defaultLicense)):this.updateLicense(null)):this.updateLicense(e.extend(!0,{},this.settings.defaultLicense))}},initLicenseLabel:function(){if(this.$input){this.$container=e(this.element.parentNode),this.$licenseLabel=e(a),this.$container.append(this.$licenseLabel),this.$licenseEnableCheck=this.$licenseLabel.find(".yb-license-enable input");var i=this;this.$licenseLabel.on("click",".yb-edit-btn button",function(){i.showLicensePicker()}),this.$licenseLabel.on("click",".yb-license-enable",function(){var s=e(this).find("input");if("function"==typeof i.settings.onEnableLicense&&!1===i.settings.onEnableLicense())return void s.prop("checked",!1);i.$licenseLabel.removeClass("enabled").removeClass("disabled"),s.prop("checked")?(i.licenseEnabled=!0,i.updateLicense(e.extend(!0,{},i.settings.defaultLicense))):(i.licenseEnabled=!1,i.updateLicense(null)),i.updateLicenseLabel()})}},initLicensePicker:function(){this.$licensePicker=e(l),e("body").append(this.$licensePicker),this.settings.licensePickerSubmitButtonText&&this.$licensePicker.find(".submit-btn button").text(this.settings.licensePickerSubmitButtonText);var i=this;this.$licensePicker.on("click",".yb-close",function(){i.hideLicensePicker()}),this.$licensePicker.on("click",".license-type .option.cc",function(){i.changeLicenseType("cc")}),this.$licensePicker.on("click",".license-type .option.cm",function(){i.changeLicenseType("cm")}),this.$licensePicker.on("click",".license-detail .cc-adaptation input, .license-detail .cm-adaptation input",function(){i.licensePickerLicense.content.adaptation=e(this).val(),i.updateLicensePicker()}),this.$licensePicker.on("click",".license-detail .cc-commercial input",function(){i.licensePickerLicense.content.commercial=e(this).val(),i.updateLicensePicker()}),this.$licensePicker.on("click",".license-detail .cm-fee .price-tag",function(){e(this).hasClass("custom")?e(this).hasClass("active")||(i.licensePickerLicense.content.price=""):i.licensePickerLicense.content.price=100*parseInt(e(this).attr("data-fee")),i.updateLicensePicker()}),this.$licensePicker.on("change",".license-detail .cm-fee .price-tag.custom input",function(){var s=e(this).val();i.$licensePicker.find(".license-detail .cm-fee .price-tag.custom").removeClass("error"),""!==s&&parseFloat(s)+""!==s||(i.licensePickerLicense.content.price=parseInt(100*s),i.updateLicensePicker())}),this.$licensePicker.on("click",".submit-btn button",function(){if("cm"===i.licensePickerLicense.type&&""===i.licensePickerLicense.content.price)return void i.$licensePicker.find(".license-detail .cm-fee .price-tag.custom").addClass("error");i.updateLicense(i.licensePickerLicense),i.updateLicenseLabel(),i.hideLicensePicker(),"function"==typeof i.settings.onLicenseSelected&&i.settings.onLicenseSelected(i.licensePickerLicense)})},updateLicenseLabel:function(){if(this.$input){if(this.$licenseLabel.removeClass("enabled").removeClass("disabled"),!this.licenseEnabled)return this.$licenseLabel.addClass("disabled"),this.$licenseEnableCheck.prop("checked",!1),void this.$input.val("");this.$licenseLabel.addClass("enabled"),this.$licenseEnableCheck.prop("checked",!0);var e=this.$licenseLabel.find(".yb-license-label");if(e.removeClass("cm").removeClass("cc"),"cc"===this.license.type){e.addClass("cc");var i=e.find(".yb-license.cc");i.removeClass("sa").removeClass("nd").removeClass("nc"),"sa"===this.license.content.adaptation?i.addClass("sa"):"n"===this.license.content.adaptation&&i.addClass("nd"),"n"===this.license.content.commercial&&i.addClass("nc")}else e.addClass("cm"),e.find(".yb-price .yb-number").text(this.license.content.price/100)}},showLicensePicker:function(){"function"==typeof this.settings.onShowLicensePicker&&!1===this.settings.onShowLicensePicker()||(this.licensePickerLicense=e.extend(!0,{},this.license),this.updateLicensePicker(),e("body").addClass("yb-no-scroll"),this.$licensePicker.show())},hideLicensePicker:function(){this.$licensePicker.hide(),e("body").removeClass("yb-no-scroll")},updateLicensePicker:function(){var e=this.$licensePicker;if(e.removeClass("cm").removeClass("cc").removeClass("sa").removeClass("nd").removeClass("nc").removeClass("ad").removeClass("ac"),e.find('input[type="radio"]').prop("checked",!1),"cc"===this.licensePickerLicense.type)e.addClass("cc"),e.find(".license-type .option.cc input").prop("checked",!0),e.find(".license-item.cc-adaptation input[value="+this.licensePickerLicense.content.adaptation+"]").prop("checked",!0),e.find(".license-item.cc-commercial input[value="+this.licensePickerLicense.content.commercial+"]").prop("checked",!0),"sa"===this.licensePickerLicense.content.adaptation?e.addClass("sa"):"n"===this.licensePickerLicense.content.adaptation?e.addClass("nd"):e.addClass("ad"),"n"===this.licensePickerLicense.content.commercial?e.addClass("nc"):e.addClass("ac");else{e.find(".license-type .option.cm input").prop("checked",!0),e.find(".license-item.cm-adaptation input[value="+this.licensePickerLicense.content.adaptation+"]").prop("checked",!0),e.find(".price-tag").removeClass("active"),e.addClass("cm"),"y"===this.licensePickerLicense.content.adaptation?e.addClass("ad"):"n"===this.licensePickerLicense.content.adaptation&&e.addClass("nd");var i=parseFloat(this.licensePickerLicense.content.price)/100;10===i||50===i||100===i||500===i?(e.find(".price-tag.t"+i).addClass("active"),e.find(".price-tag.custom input").val("")):(e.find(".price-tag.custom").addClass("active"),""!==this.licensePickerLicense.content.price&&e.find(".price-tag.custom input").val(i)),e.find(".license-preview .yb-license.cm .yb-price .yb-number").text(this.licensePickerLicense.content.price/100)}},changeLicenseType:function(e){this.licensePickerLicense.type=e,this.licensePickerLicense.content="cc"===e?{adaptation:"sa",commercial:"n"}:{adaptation:"y",price:5e3},this.updateLicensePicker()},updateLicense:function(e){this.license=e,null!==e?(this.$input&&this.$input.val(JSON.stringify(this.license)),this.storeLicenseInLocalStorage()):(this.$input&&this.$input.val(""),this.clearLicenseInLocalStorage())},storeLicenseInLocalStorage:function(){localStorage&&localStorage.setItem("yb-license-editor-license",JSON.stringify(this.license))},getLicenseFromLocalStorage:function(){if(!localStorage)return null;var e=localStorage.getItem("yb-license-editor-license");return e?JSON.parse(e):null},clearLicenseInLocalStorage:function(){localStorage&&localStorage.removeItem("yb-license-editor-license")}}),e.fn.ybLicenseEditor=function(i){return this.each(function(){e.data(this,"plugin_ybLicenseEditor")||e.data(this,"plugin_ybLicenseEditor",new n(this,i))})};var a='<div class="yb-license-editor"><label class="yb-license-enable"><input type="checkbox" />使用<a href="https://yuanben.io" target="_blank">「原本」</a>进行版权保护和转载监控</label><div class="yb-license-introduction"><a href="https://yuanben.io/authors" target="_blank" >立即开启全网版权溯源、侵权检测和版权自助交易功能</a></div><div class="yb-license-label"><div class="yb-label-name"><span class="cc">知识共享协议：</span><span class="cm">付费转载协议：</span></div><div class="yb-icons"><div class="yb-license cc"><a href="javascript:void(0)" title="知识共享（CC）4.0协议" class="yb-icon cc"></a><a href="javascript:void(0)" title="必须按照许可人指定的方式对作品进行署名" class="yb-icon by"></a><a href="javascript:void(0)" title="仅被授权出于非商业目的而复制、发行、展览和表演作品" class="yb-icon nc"></a><a href="javascript:void(0)" title="不允许基于该作品创作演绎作品" class="yb-icon nd"></a><a href="javascript:void(0)" title="您可以复制、发行、展览和表演作品，也必须允许他人基于该作品创作演绎作品" class="yb-icon sa"></a></div><div class="yb-license cm"><a href="javascript:void(0)" title="商业授权" class="yb-icon cm"></a><span class="yb-price">授权费用&nbsp;￥<span class="yb-number"></span></span></div></div><div class="yb-edit-btn"><button type="button">修改协议</button></div></div></div>',l='<div class="yb-license-picker"><div class="yb-picker-modal"><div class="yb-title"><div class="tb-title-name">原本认证</div><div class="yb-close">×</div></div><div class="yb-content"><div class="license-type"><div class="description">1. 请选择转载许可协议:</div><div class="options"><div class="option cc"><div class="icon"></div><label><input type="radio" name="license-type" value="cc" />知识共享许可协议</label></div><div class="option cm"><div class="icon"></div><label><input type="radio" name="license-type" value="cm" />商业许可协议</label></div></div></div><div class="license-detail"><div class="cc-adaptation license-item"><div class="description">2. 是否允许你的作品被改编:</div><div class="question n3"><div class="radio-box"><input type="radio" class="radio-input" name="cc-adaptation" value="y"/><div class="radio-label">是</div></div><div class="radio-box"><input type="radio" class="radio-input" name="cc-adaptation" value="n"/><div class="radio-label">否</div></div><div class="radio-box"><input type="radio" class="radio-input" name="cc-adaptation" value="sa"/><div class="radio-label">是，只要他人以相同方式共享</div></div></div></div><div class="cc-commercial license-item"><div class="description">3. 是否允许商业使用:</div><div class="question n2"><div class="radio-box"><input type="radio" class="radio-input" name="cc-commercial" value="y"/><div class="radio-label">是</div></div><div class="radio-box"><input type="radio" class="radio-input" name="cc-commercial" value="n"/><div class="radio-label">否</div></div></div></div><div class="cm-adaptation license-item"><div class="description">2. 是否允许你的作品被改编:</div><div class="question n2"><div class="radio-box"><input type="radio" class="radio-input" name="cc-adaptation" value="y"/><div class="radio-label">是</div></div><div class="radio-box"><input type="radio" class="radio-input" name="cc-adaptation" value="n"/><div class="radio-label">否</div></div></div></div><div class="cm-fee license-item"><div class="description">3. 设置转载价格:</div><div class="question"><div class="price-tag-wrapper"><div class="price-tag t10" data-fee="10">10元</div><div class="price-tag t50" data-fee="50">50元</div><div class="price-tag t100" data-fee="100">100元</div><div class="price-tag t500" data-fee="500">500元</div><div class="price-tag custom" ><input type="text" placeholder="自定义金额"/><div class="text">元</div></div></div></div></div></div><div class="license-preview"><div class="description">你选择的转载许可协议：</div><div class="license-preview-content"><div class="yb-icons large"><div class="yb-license cc"><a href="javascript:void(0)" title="知识共享（CC）4.0协议" class="yb-icon cc"></a><a href="javascript:void(0)" title="必须按照许可人指定的方式对作品进行署名" class="yb-icon by"></a><a href="javascript:void(0)" title="仅被授权出于非商业目的而复制、发行、展览和表演作品" class="yb-icon nc"></a><a href="javascript:void(0)" title="不允许基于该作品创作演绎作品" class="yb-icon nd"></a><a href="javascript:void(0)" title="您可以复制、发行、展览和表演作品，也必须允许他人基于该作品创作演绎作品" class="yb-icon sa"></a></div><div class="yb-license cm"><a href="javascript:void(0)" title="商业授权" class="yb-icon cm"></a><span class="yb-price">授权费用&nbsp;￥<span class="yb-number"></span></span></div></div><div class="license cc"><div class="text"><span>本作品采用<a class="license-link nd nc" href="http://creativecommons.org/licenses/by-nc-nd/4.0" target="_blank">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a><a class="license-link ad nc" href="http://creativecommons.org/licenses/by-nc/4.0" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a><a class="license-link sa nc" href="http://creativecommons.org/licenses/by-nc-sa/4.0" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a><a class="license-link nd ac" href="http://creativecommons.org/licenses/by-nd/4.0" target="_blank">知识共享署名-禁止演绎 4.0 国际许可协议</a><a class="license-link ad ac" href="https://creativecommons.org/licenses/by/4.0" target="_blank">知识共享署名4.0国际许可协议</a><a class="license-link sa ac" href="http://creativecommons.org/licenses/by-sa/4.0" target="_blank">知识共享署名-相同方式共享 4.0 国际许可协议</a>进行许可</span><ul class="details"><li class="cc">允许复制、发行、展览和表演作品，但必须按照指定的方式对作品进行署名</li><li class="nc">允许出于非商业目的复制、发行、展览和表演作品</li><li class="ac">允许复制、发行、展览和表演作品，包括出于商业目的进行上述活动</li><li class="nd">允许复制、发行、展览和表演作品，但不允许基于该作品创作演绎作品</li><li class="ad">允许复制、发行、展览和表演作品，也允许基于该作品创作演绎作品</li><li class="sa">允许复制、发行演绎作品，但演绎作品必须采用与本协议相同或兼容的协议进行许可</li></ul></div></div><div class="license cm"><div class="text"><span>本作品使用商业许可协议进行许可</span><ul class="details"><li class="nd">不允许修改原作品，不允许再创作</li><li class="ad">允许修改原作品和再创作</li></ul></div></div></div></div><div class="submit-box"><div class="submit-btn"><button type="button">保存</button></div></div></div></div></div>'}(jQuery,window,document);